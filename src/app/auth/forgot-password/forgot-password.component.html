<div class="login-container" [class.rtl]="currentLang === 'ar'">
  <!-- Left Side - Forgot Password Form -->
  <div class="login-form-section">
    <div class="form-wrapper">
      <div class="header-section">
        <div class="mb-5" *ngIf="step === 2" style="margin-bottom: 3rem !important;">
          <img src="../../../assets/images/reminder.png" />
        </div>

        <h1 class="login-title" *ngIf="step !== 3">{{ 'FORGOT.TITLE' | translate }}</h1>
        <h1 class="login-title" *ngIf="step === 3">{{ 'FORGOT.RESET_TITLE' | translate }}</h1>
        <p class="login-subtitle" *ngIf="step === 1">{{ 'FORGOT.SUBTITLE' | translate }}</p>
      </div>

      <!-- Step 1: Enter Email -->
      <form *ngIf="step === 1" (ngSubmit)="sendEmail()" class="login-form">
        <mat-label class="mb-2">{{ 'FORGOT.EMAIL_LABEL' | translate }}</mat-label>
        <mat-form-field appearance="outline" class="full-width">
          <input matInput type="email" [(ngModel)]="email" name="email" required />
        </mat-form-field>
        <button mat-raised-button class="login-btn full-width">
          {{ 'FORGOT.CONTINUE' | translate }}
        </button>
      </form>

      <!-- Step 2: Enter OTP -->
      <form *ngIf="step === 2" (ngSubmit)="verifyOtp()" class="login-form">
        <p class="d-block text-center" style="text-align: center !important;">
          {{ 'FORGOT.OTP_MESSAGE' | translate:{ email: email } }}
        </p>
        <mat-label>{{ 'FORGOT.OTP_LABEL' | translate }}</mat-label>
        <div class="otp-inputs">
          <input *ngFor="let ctrl of otpControls; let i = index"
                 matInput
                 maxlength="1"
                 type="text"
                 pattern="[0-9]*"
                 [attr.inputmode]="'numeric'"
                 [(ngModel)]="otpArray[i]"
                 name="otp{{i}}"
                 required
                 #otpInput
                 (input)="onOtpInput($event, i)"
                 (keydown)="onOtpKeyDown($event, i)">
        </div>
        <div class="otp-timer">
          <span *ngIf="otpCounter > 0">{{ otpCounter }}s</span>
          <button *ngIf="otpCounter === 0" mat-button type="button" (click)="resendOtp()">
            {{ 'FORGOT.RESEND' | translate }}
          </button>
        </div>
        <button mat-raised-button class="login-btn full-width">
          {{ 'FORGOT.VERIFY' | translate }}
        </button>
      </form>

      <!-- Step 3: New Password -->
      <form *ngIf="step === 3" (ngSubmit)="resetPassword()" class="login-form">
        <p class="login-subtitle text-center mb-3">{{ 'FORGOT.RESET_SUBTITLE' | translate }}</p>
        <mat-label>{{ 'FORGOT.NEW_PASSWORD_LABEL' | translate }}</mat-label>
        <mat-form-field appearance="outline" class="full-width">
          <input matInput
                 [type]="showPassword ? 'text' : 'password'"
                 [(ngModel)]="password"
                 name="password"
                 required
                 (ngModelChange)="validatePassword()" />
          <button mat-icon-button matSuffix type="button" (click)="showPassword = !showPassword">
            <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </mat-form-field>

        <mat-label>{{ 'FORGOT.CONFIRM_PASSWORD_LABEL' | translate }}</mat-label>
        <mat-form-field appearance="outline" class="full-width">
          <input matInput
                 [type]="showConfirmPassword ? 'text' : 'password'"
                 [(ngModel)]="confirmPassword"
                 name="confirmPassword"
                 required />
          <button mat-icon-button matSuffix type="button" (click)="showConfirmPassword = !showConfirmPassword">
            <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </mat-form-field>
        <ul class="password-rules">
          <li *ngFor="let rule of passwordRules">
            <img [src]="rule.valid ? '../../../assets/icons/tick-circle.png' : '../../../assets/icons/close-circle.png'" 
                 [class.valid]="rule.valid" [class.invalid]="!rule.valid" width="12" height="12" />
            <span [class.valid]="rule.valid" [class.invalid]="!rule.valid">{{ rule.label }}</span>
          </li>
        </ul>
        <button mat-raised-button class="login-btn full-width">
          {{ 'FORGOT.SAVE_NEW_PASSWORD' | translate }}
        </button>
        <button
          type="button"
          class="suggest-password-btn full-width"
          (click)="suggestPassword()"
        >
          اقترح كلمة المرور
        </button>
      </form>
      
    </div>
  </div>

  <!-- Right Side -->
  <div class="airplane-section">
    <div class="content-overlay">
      <div class="logo-section">
        <img src="../../../assets/images/login-logo.png" alt="Logo" class="logo-image" />
      </div>
      <div class="welcome-section">
        <h2 class="welcome-title">{{ 'FORGOT.WELCOME' | translate }}</h2>
        <p class="welcome-subtitle">{{ 'FORGOT.INSTRUCTIONS' | translate }}</p>
      </div>
    </div>
  </div>
</div>
